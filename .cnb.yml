# CNBæ„å»ºé…ç½®æ–‡ä»¶
# æ–‡æ¡£å‚è€ƒï¼šhttps://docs.cnb.cool/zh/grammar/pipeline.html

# è§¦å‘è§„åˆ™ï¼šåœ¨ main åˆ†æ”¯æ¨é€æ—¶è§¦å‘
main:
  push:
    - stages:
        - name: ç¼–è¯‘ä¸æ„å»º
          # ä½¿ç”¨ Eclipse Temurin JDK 21ï¼Œä¸é¡¹ç›® Java ç‰ˆæœ¬ä¸€è‡´
          image: docker.io/library/eclipse-temurin:21-jdk
          
          # ç¼“å­˜é…ç½®ï¼šç¼“å­˜ Gradle ä¾èµ–å’Œ Wrapperï¼Œä»¥åŠ Fabric Loom çš„ç¼“å­˜
          # è¿™èƒ½æ˜¾è‘—åŠ å¿«éé¦–æ¬¡æ„å»ºçš„é€Ÿåº¦
          caches:
            - ~/.gradle/caches
            - ~/.gradle/wrapper
            - .gradle/loom-cache
          
          script:
            - echo "ğŸ” æ£€æŸ¥ç¯å¢ƒä¿¡æ¯..."
            - java -version
            
            - echo "ğŸš€ å¼€å§‹æ„å»º..."
            - chmod +x gradlew
            
            # æ‰§è¡Œæ„å»º
            # --no-daemon: CI ç¯å¢ƒä¸ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹ï¼ŒèŠ‚çœèµ„æº
            # --build-cache: å¼€å¯ Gradle æ„å»ºç¼“å­˜
            # --stacktrace: å‡ºé”™æ—¶æ‰“å°å †æ ˆä¿¡æ¯
            - ./gradlew build --no-daemon --build-cache --stacktrace
            
            - echo "âœ… æ„å»ºå®Œæˆï¼æ£€æŸ¥äº§ç‰©..."
            - ls -lh build/libs/

            # (å¯é€‰) å¦‚æœåç»­éœ€è¦å‘å¸ƒï¼Œå¯ä»¥åœ¨æ­¤å¤„æ·»åŠ å‘å¸ƒå‘½ä»¤
            # éœ€å…ˆåœ¨å¹³å°è®¾ç½®ç¯å¢ƒå˜é‡
            # - ./gradlew publish
